{{ ansible_managed | comment }}
#
# Mobian: default enabled but conditional to /etc/rsyncd.conf which does not exist initially
# Exposure 8.5 -> ?
[Service]
# Default in upstream unit
# Citing README.md:
#
#   [...] Using ssh is recommended for its security features.
#
#   Alternatively, rsync can run in `daemon' mode, listening on a socket.
#   This is generally used for public file distribution, [...]
#
# So let's assume some extra security is more than welcome here. We do full
# system protection (which makes /usr, /boot, & /etc read-only) and hide
# devices. To override these defaults, it's best to do so in the drop-in
# directory, often done via `systemctl edit rsync.service`. The file needs
# just the bare minimum of the right [heading] and override values.
# See systemd.unit(5) and search for "drop-in" for full details.

ProtectSystem=full
#ProtectHome=on|off|read-only
ProtectHome=on
PrivateDevices=on
NoNewPrivileges=on

# PrivateNetwork=yes
RestrictAddressFamilies=AF_INET AF_INET6
IPAccounting=yes
IPAddressAllow=localhost link-local multicast 10.0.0.0/8 192.168.0.0/16
# IPAddressDeny= service needs access to all IPs

# ReadOnlyPaths=/path/to/rsync/root
# ReadWritePaths=/path/to/rsync/root
PrivateTmp=yes

# PrivateUsers=yes
# DynamicUser=

ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectKernelLogs=yes

UMask=077
CapabilityBoundingSet=~CAP_SETUID CAP_SETGID CAP_SETPCAP
CapabilityBoundingSet=~CAP_SYS_ADMIN
CapabilityBoundingSet=~CAP_SYS_PTRACE
CapabilityBoundingSet=~CAP_CHOWN CAP_FSETID CAP_SETFCAP
CapabilityBoundingSet=~CAP_DAC_* CAP_FOWNER CAP_IPC_OWNER
CapabilityBoundingSet=~CAP_NET_ADMIN
CapabilityBoundingSet=~CAP_SYS_MODULE
CapabilityBoundingSet=~CAP_SYS_RAWIO
CapabilityBoundingSet=~CAP_SYS_BOOT
CapabilityBoundingSet=~CAP_LINUX_IMMUTABLE
CapabilityBoundingSet=~CAP_IPC_LOCK
CapabilityBoundingSet=~CAP_SYS_CHROOT
# AmbientCapabilities=
ProtectHostname=yes
ProtectClock=yes
ProtectControlGroups=yes
RestrictNamespaces=yes
LockPersonality=yes
MemoryDenyWriteExecute=yes
RestrictRealtime=yes
RestrictSUIDSGID=yes
# RemoveIPC=

SystemCallFilter=@system-service
SystemCallFilter=~@clock @debug @mount @resources @reboot @swap @module @privileged
SystemCallArchitectures=native
